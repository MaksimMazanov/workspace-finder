# TASK-04: localStorage кеширование данных

**Приоритет:** MEDIUM

**Статус:** TODO

**Зависимости:** TASK-02 (MongoDB интеграция)

**Время выполнения:** ~2 часа

## Описание

Реализовать кеширование данных рабочих мест в localStorage для быстрой загрузки и offline просмотра. Кеш имеет TTL (Time To Live) 5 минут, после чего данные обновляются с сервера. MongoDB уже подключена и работает как основной источник данных.

## Контекст

Согласно PRD, приложение должно работать быстро на мобильных устройствах (загрузка < 2 сек на 4G). Кеширование данных в localStorage снижает нагрузку на сервер и ускоряет повторные загрузки. При этом MongoDB обеспечивает надежное хранилище на стороне сервера.

## Технические требования

### 1. Создать hook `useLocalStorageCache`:

**Файл:** `src/hooks/useLocalStorageCache.ts`

**Функциональность:**
- Сохранение данных в localStorage с timestamp
- Проверка TTL (5 минут)
- Автоматическая инвалидация устаревшего кеша
- Типобезопасность (generic типы)
- Обработка ошибок при работе с localStorage
- Логирование при загрузке из кеша

**Сигнатура:**
```typescript
function useLocalStorageCache<T>(
  key: string,
  fetcher: () => Promise<T>,
  ttl?: number
): { data: T | null; loading: boolean; error: Error | null }
```

### 2. Интегрировать в TableView:

- При загрузке сначала проверять кеш
- Если кеш валидный - показывать данные из кеша БЕЗ спиннера
- Параллельно делать запрос к API/MongoDB для обновления
- Если кеша нет или истек - показывать спиннер и загружать данные
- При получении новых данных плавно обновлять UI

### 3. Интегрировать в SearchBar:

- Кешировать последние результаты поиска
- Кеш по ключу `search:${type}:${query}`
- TTL: 5 минут
- Показывать результаты из кеша при повторном поиске

### 4. Очистка старых ключей:

- При инициализации хука проверять и удалять ключи с истекшим TTL
- Не хранить в памяти неактивные кеши

## Критерии приемки

### Функциональные:

- [ ] При первой загрузке TableView запрашивает данные с API/MongoDB
- [ ] Данные сохраняются в localStorage под ключом `workspace-finder:cache:workplaces`
- [ ] При повторной загрузке (в течение 5 минут) данные берутся из кеша без спиннера
- [ ] Параллельно запрашиваются новые данные с сервера
- [ ] При получении данных с сервера UI обновляется плавно
- [ ] Через 5 минут кеш инвалидируется и данные загружаются заново
- [ ] Результаты поиска кешируются по ключу `workspace-finder:cache:search:${type}:${query}`
- [ ] При очистке localStorage старые ключи удаляются корректно

### Нефункциональные:

- [ ] Hook имеет полную TypeScript типизацию
- [ ] Обработаны ошибки localStorage (QuotaExceededError, другие исключения)
- [ ] В консоль логируется: "Cache hit for key: ...", "Cache miss for key: ..."
- [ ] Время загрузки из кеша < 100ms
- [ ] Размер кеша не превышает 5MB (контроль при сохранении)

## Ожидаемый результат

Пользователь открывает приложение - видит данные из кеша мгновенно, затем в фоне загружаются новые данные. Повторные поиски показывают результаты из кеша. При умышленной очистке кеша (например, через DevTools) данные загружаются заново с сервера.
