# Product Requirements Document: WorkspaceFinder

## Executive Summary

**WorkspaceFinder** — мобильное веб-приложение для поиска и управления рабочими местами в технопарке. Приложение позволяет сотрудникам быстро найти рабочее место по ФИО или номеру места, просмотреть статус коворкингов и получить информацию о подразделении и команде сотрудника.

**MVP цель:** Создать простое, быстрое мобильное приложение с поддержкой администраторской загрузки данных (XLS) и четырех видов отображения рабочих мест.

---

## Mission

**Миссия:** Упростить навигацию по рабочим местам технопарка, позволяя сотрудникам находить места и контакты коллег за секунды.

### Основные принципы

1. **Мобильность прежде всего** — приложение оптимизировано для смартфонов и планшетов
2. **Скорость поиска** — быстрый поиск по ФИО или номеру места без лишних кликов
3. **Простота взаимодействия** — минимум действий, максимум информации
4. **Гибкость отображения** — несколько видов (таблица, коворкинги, статистика, карта зон)
5. **Административный контроль** — только администраторы загружают и обновляют данные

---

## Target Users

### Основная целевая аудитория

- **Сотрудники технопарка** (250 человек) — ищут свое место и места коллег
- **Администраторы офиса** (1-2 человека) — загружают/обновляют данные XLS

### Ключевые потребности

1. Быстрый поиск места по ФИО сотрудника
2. Поиск сотрудника по номеру рабочего места
3. Просмотр статуса коворкингов (90 мест)
4. Информация о подразделении и команде сотрудника
5. Удобный доступ на мобильном устройстве

---

## MVP Scope

### ✅ In Scope - Core Functionality

**Функциональность:**
- ✅ Вход по имени сотрудника (без пароля)
- ✅ Поиск по ФИО сотрудника (занятые места)
- ✅ Поиск по номеру рабочего места (5.В.01.056)
- ✅ Таблично-блочный вид с разбиением на 4 блока: 5.А.01, 5.А.02, 5.В.01, 5.В.02
- ✅ Вид коворкингов (список коворкингов с количеством занятых мест)
- ✅ Вид статистики (общие показатели)
- ✅ Вид карты зон (распределение мест по зонам)
- ✅ Переключение между видами
- ✅ Отображение информации о месте:
  - Номер помещения (5.В.01.056)
  - Тип рабочего места (Openspace)
  - Наименование зоны
  - ФИО сотрудника
  - Подразделение (Блок-1)
  - Команда
  - Должность

**Административная функциональность:**
- ✅ Desktop интерфейс для загрузки XLS-файла
- ✅ Парсинг листа "Подробно" с маппингом полей
- ✅ Полная замена старых данных при загрузке
- ✅ Проверка целостности данных перед сохранением
- ✅ Визуальная обратная связь при загрузке

**Техническое:**
- ✅ React фронтенд с TypeScript
- ✅ Облачная база данных (Firebase / MongoDB)
- ✅ Отзывчивый мобильный дизайн
- ✅ Русский язык интерфейса
- ✅ Локальное хранилище для кеша данных
- ✅ Поддержка светлой/темной темы (системная)

### ❌ Out of Scope - Future Features

**Функциональность:**
- ❌ Бронирование рабочих мест
- ❌ История изменений занятости
- ❌ QR-коды на местах
- ❌ Экспорт данных (PDF, Excel)
- ❌ Аналитика и графики занятости
- ❌ Интеграция с LDAP/Active Directory
- ❌ Многоязычность (кроме русского)

**Технические:**
- ❌ Offline режим (PWA)
- ❌ Системы уведомлений
- ❌ Синхронизация между устройствами
- ❌ API для третьих сторон

---

## User Stories

### Основные пользовательские истории

**US-1: Сотрудник вводит свое имя**
- **Как** новый пользователь
- **Я хочу** ввести свое имя и попасть в приложение
- **Чтобы** увидеть доступные виды поиска

*Пример:* Пользователь открывает приложение, видит форму "Введите ваше имя", пишет "Иванов Иван Иванович", кликает "Входить", переходит на главный экран.

**US-2: Поиск по ФИО**
- **Как** сотрудник
- **Я хочу** найти рабочее место по ФИО коллеги
- **Чтобы** узнать, где он сидит

*Пример:* В поле поиска вводит "Петров", видит результат "Петров Петр Петрович — 5.В.01.056, Open Space, Подразделение: АО Банк".

**US-3: Поиск по номеру места**
- **Как** сотрудник
- **Я хочу** найти сотрудника по номеру его рабочего места
- **Чтобы** узнать, кто там работает

*Пример:* Вводит номер "5.В.01.056", видит результат с ФИО, подразделением, командой.

**US-4: Просмотр таблицы мест по блокам**
- **Как** сотрудник
- **Я хочу** видеть все рабочие места разбитые на 4 блока
- **Чтобы** быстро ориентироваться в офисе

*Пример:* На экране 4 секции (5.А.01, 5.А.02, 5.В.01, 5.В.02), в каждой — таблица мест с ФИО сотрудников, статус занятости.

**US-5: Просмотр коворкингов**
- **Как** сотрудник
- **Я хочу** увидеть статус всех коворкингов
- **Чтобы** узнать, есть ли свободные места

*Пример:* Вид "Коворкинги" показывает "Coworking-1: 37 занято из 53" и список занятых мест.

**US-6: Администратор загружает XLS**
- **Как** администратор
- **Я хочу** загрузить новый XLS-файл и заменить данные
- **Чтобы** актуализировать информацию о рабочих местах

*Пример:* На desktop версии администратор видит форму "Загрузить файл", выбирает XLS, система парсит данные, показывает "✅ Загружено 260 мест", старые данные удаляются.

**US-7: Переключение между видами**
- **Как** сотрудник
- **Я хочу** переключаться между таблицей, коворкингами, статистикой и картой
- **Чтобы** увидеть данные в удобном формате

*Пример:* Внизу экрана 4 иконки (Таблица, Коворкинги, Статистика, Карта), клик переводит на соответствующий вид.

---

## Core Architecture & Patterns

### Высокоуровневая архитектура

```
┌──────────────────────────────────────┐
│   React App (Mobile + Desktop)       │
│   - Поиск, фильтры, виды             │
└────────────┬─────────────────────────┘
             │ HTTP/REST
             │
┌────────────▼─────────────────────────┐
│   Node.js + Express Backend          │
│   - REST API для данных              │
│   - Парсинг XLS, валидация           │
│   - Управление сессиями              │
└────────────┬─────────────────────────┘
             │ Driver
             │
┌────────────▼─────────────────────────┐
│   Cloud Database (Firebase/MongoDB)  │
│   - Рабочие места                    │
│   - Сотрудники                       │
│   - История загрузок                 │
└──────────────────────────────────────┘
```

### Directory Structure

```
workspace-finder/
├── frontend/                     # React приложение
│   ├── src/
│   │   ├── pages/
│   │   │   ├── LoginPage.tsx       # Вход по имени
│   │   │   ├── DashboardPage.tsx   # Главная страница с поиском
│   │   │   ├── TableView.tsx       # Вид таблицы по блокам
│   │   │   ├── CoworkingView.tsx   # Вид коворкингов
│   │   │   ├── StatsView.tsx       # Вид статистики
│   │   │   ├── MapView.tsx         # Вид карты зон
│   │   │   └── AdminPanel.tsx      # Admin панель загрузки XLS
│   │   ├── components/
│   │   │   ├── SearchBar.tsx       # Поле поиска
│   │   │   ├── ResultCard.tsx      # Карточка результата
│   │   │   ├── BlockTable.tsx      # Таблица блока мест
│   │   │   ├── CoworkingCard.tsx   # Карточка коворкинга
│   │   │   └── ViewSwitcher.tsx    # Переключатель видов
│   │   ├── api/
│   │   │   └── workspaceApi.ts     # RTK Query / Fetch API
│   │   ├── hooks/
│   │   │   ├── useSearch.ts
│   │   │   └── useViewMode.ts
│   │   ├── types/
│   │   │   └── index.ts            # TypeScript types
│   │   ├── utils/
│   │   │   └── parseXLS.ts         # Парсинг XLS на фронте
│   │   ├── App.tsx
│   │   └── index.tsx
│   ├── package.json
│   └── tsconfig.json
│
├── backend/                      # Node.js приложение
│   ├── src/
│   │   ├── routes/
│   │   │   ├── workplaces.js       # GET /api/workplaces
│   │   │   ├── search.js           # GET /api/search?q=...
│   │   │   ├── admin.js            # POST /api/admin/upload
│   │   │   └── stats.js            # GET /api/stats
│   │   ├── controllers/
│   │   │   ├── workplaceController.js
│   │   │   ├── searchController.js
│   │   │   └── adminController.js
│   │   ├── models/
│   │   │   ├── Workplace.js        # MongoDB schema
│   │   │   └── ImportLog.js
│   │   ├── middleware/
│   │   │   └── auth.js             # Простая сессия
│   │   ├── utils/
│   │   │   └── xlsParser.js        # Парсинг XLS (xlsx lib)
│   │   └── index.js                # Express app entry
│   ├── package.json
│   └── .env.example
│
└── docker-compose.yml            # Локальная разработка с MongoDB
```

### Key Design Patterns

**Frontend:**
- Custom React Hooks для логики поиска и управления видами
- Context API для глобального состояния (текущий пользователь, данные)
- Optimistic UI updates для поиска
- Lazy loading компонентов для разных видов

**Backend:**
- REST API с четким разделением concerns (routes → controllers → services)
- Middleware для валидации XLS
- Transaction для удаления старых данных и добавления новых атомарно
- In-memory кеширование часто запрашиваемых данных (статистика, коворкинги)

---

## Features Breakdown

### 1. Authentication (простой вход)

```typescript
// Юзер вводит имя, это сохраняется в localStorage
interface User {
  name: string
  enteredAt: Date
}
```

**Endpoints:**
- `POST /api/auth/login` — сохранить имя пользователя (не требует пароля)
- `GET /api/auth/me` — получить текущего пользователя

### 2. Search (поиск)

**Endpoints:**
- `GET /api/search?type=name&q=Иванов` — поиск по ФИО (возвращает массив результатов)
- `GET /api/search?type=place&q=5.В.01.056` — поиск по номеру места

**Response:**
```json
{
  "results": [
    {
      "id": "unique-id",
      "placeNumber": "5.В.01.056",
      "placeName": "5.В.01.056",
      "zone": "Open space 29",
      "blockCode": "5.В.01",
      "employeeName": "Иванов Иван Иванович",
      "department": "Департамент ИТ блока 'Сеть продаж'",
      "team": "SberGeo",
      "position": "Ведущий инженер по разработке",
      "type": "Openspace",
      "status": "occupied"
    }
  ]
}
```

### 3. Table View (таблица по блокам)

**Endpoint:**
- `GET /api/workplaces?view=table` — получить все места, разбитые на 4 блока

**Data Structure:**
```json
{
  "blocks": [
    {
      "code": "5.А.01",
      "name": "5.А.01.xxx",
      "places": [
        {
          "id": "...",
          "placeNumber": "5.А.01.100",
          "employeeName": "...",
          "department": "...",
          "team": "..."
        }
      ]
    }
  ]
}
```

### 4. Coworking View (коворкинги)

**Endpoint:**
- `GET /api/coworkings` — получить статистику коворкингов

**Response:**
```json
{
  "coworkings": [
    {
      "id": "cw-1",
      "name": "Coworking-1",
      "total": 53,
      "occupied": 37,
      "places": [
        {
          "placeNumber": "5.А.02.200",
          "employeeName": "Петров Петр Петрович",
          "department": "..."
        }
      ]
    }
  ],
  "total": 90,
  "totalOccupied": 37
}
```

### 5. Statistics View (статистика)

**Endpoint:**
- `GET /api/stats` — получить общую статистику

**Response:**
```json
{
  "totalPlaces": 250,
  "occupiedPlaces": 260,
  "coworkingPlaces": 90,
  "occupiedCoworking": 37,
  "blockStats": {
    "5.А.01": { "total": 65, "occupied": 60 },
    "5.А.02": { "total": 60, "occupied": 55 },
    "5.В.01": { "total": 65, "occupied": 62 },
    "5.В.02": { "total": 60, "occupied": 55 }
  }
}
```

### 6. Map View (карта зон)

**Endpoint:**
- `GET /api/zones` — получить информацию по зонам

**Response:**
```json
{
  "zones": [
    {
      "name": "Open space 29",
      "type": "openspace",
      "totalPlaces": 20,
      "occupiedPlaces": 18,
      "places": [...]
    }
  ]
}
```

### 7. Admin Upload (загрузка XLS)

**Endpoint:**
- `POST /api/admin/upload` — загрузить XLS файл (только для администраторов)

**Request:** multipart/form-data с файлом

**Process:**
1. Проверить формат файла (только .xlsx)
2. Парсить лист "Подробно"
3. Валидировать данные (наличие обязательных колонок)
4. Очистить старые данные
5. Вставить новые данные
6. Вернуть отчет ("Загружено 260 мест из 262 строк")

---

## Technology Stack

### Frontend
- **React 19+** с TypeScript
- **Vite** для бережной разработки
- **React Router v7** для навигации
- **Fetch API** или **RTK Query** для HTTP запросов
- **TailwindCSS** или **shadcn/ui** для стилей
- **xlsx** lib для локального парсинга XLS
- **localStorage** для кеша данных и сессии пользователя

### Backend
- **Node.js 20+** с Express.js
- **TypeScript**
- **MongoDB** или **Firebase** для облачной БД
- **xlsx** lib для парсинга XLS на сервере
- **joi** для валидации схемы
- **CORS** middleware для кроссовых запросов

### DevOps
- **Docker** + **docker-compose** для локальной разработки
- **GitHub Actions** для CI/CD (опционально)
- **Vercel** или **Railway** для деплоя фронта
- **MongoDB Atlas** или **Firebase** для облачной БД

---

## Security & Configuration

### Authentication
- Простой вход по имени (без пароля) — имя сохраняется в localStorage
- Опционально: защита admin-панели с помощью fixed пароля или IP-whitelist

### Data Protection
- HTTPS для всех запросов к облачной БД
- CORS ограничения для API (only from domain)
- Валидация XLS перед загрузкой (размер файла, формат)

### Configuration
```
Backend .env:
DATABASE_URL=mongodb+srv://...
NODE_ENV=production
PORT=3000
ADMIN_PASSWORD=xxx (опционально)

Frontend .env:
REACT_APP_API_URL=https://api.example.com
```

---

## Success Criteria

### MVP Функциональность ✅
- ✅ Поиск по ФИО работает без задержек
- ✅ Поиск по номеру места возвращает точный результат
- ✅ Таблица по 4 блокам отображается корректно на мобильном
- ✅ Коворкинги показывают правильные данные
- ✅ Администратор может загрузить XLS и заменить данные за < 5 секунд
- ✅ Все 4 вида отображения работают

### Quality ✅
- ✅ Загрузка страницы < 2 сек на 4G
- ✅ Поиск работает в реальном времени (< 500ms)
- ✅ Интерфейс адаптирован под экраны от 320px (iPhone SE)
- ✅ Без ошибок в консоли при использовании
- ✅ Данные кешируются локально для offline просмотра

### User Experience ✅
- ✅ Вход по имени занимает < 10 секунд
- ✅ Поиск результата занимает < 3 сек
- ✅ Переключение между видами плавное и быстрое
- ✅ Шрифты читаемы на мобильном (минимум 14px)
- ✅ Темная тема соответствует системным настройкам

---

## Implementation Phases

### Phase 1: Core Backend & Frontend Setup (2 недели)
**Цель:** Базовая инфраструктура и API

**Deliverables:**
- ✅ Express.js сервер с REST API
- ✅ MongoDB/Firebase подключение
- ✅ React приложение с базовой структурой
- ✅ Простой вход по имени
- ✅ Docker setup для локальной разработки

**Validation:**
- Backend запускается на localhost:3000
- Frontend запускается на localhost:5173
- Простой API тест возвращает 200

### Phase 2: Search & Table View (2 недели)
**Цель:** Реализовать поиск и основной вид отображения

**Deliverables:**
- ✅ Поиск по ФИО с результатами
- ✅ Поиск по номеру места
- ✅ Таблица по 4 блокам (5.А.01, 5.А.02, 5.В.01, 5.В.02)
- ✅ Карточка результата с деталями сотрудника
- ✅ Кеширование данных в localStorage

**Validation:**
- Поиск "Иванов" возвращает минимум 1 результат
- Таблица показывает все 4 блока
- На мобильном экран не режится

### Phase 3: Additional Views & Admin Panel (2 недели)
**Цель:** Все виды отображения и админ-панель

**Deliverables:**
- ✅ Вид коворкингов (список с количеством)
- ✅ Вид статистики (общие показатели)
- ✅ Вид карты зон (распределение по зонам)
- ✅ Переключатель между видами (bottom tabs)
- ✅ Admin панель для загрузки XLS (desktop)
- ✅ Парсинг XLS и вставка в БД

**Validation:**
- Все 4 вида доступны и работают
- XLS загружается и появляется в таблице через 5 сек
- Администратор видит отчет "Загружено 260 мест"

### Phase 4: Polish & Optimization (1 неделя)
**Цель:** Финальная оптимизация и готовность к продакшену

**Deliverables:**
- ✅ Оптимизация производительности (< 2 сек загрузка)
- ✅ Обработка ошибок (сетевые ошибки, невалидный XLS)
- ✅ Тестирование на реальных мобильных устройствах
- ✅ Документация для администраторов
- ✅ Финальные баги-фиксы

**Validation:**
- Lighthouse score > 85
- Работает на iOS 13+ и Android 8+
- Нет потери данных при сетевых ошибках

---

## Data Model

### Workplace Schema
```typescript
interface Workplace {
  _id: ObjectId
  placeNumber: string              // "5.В.01.056"
  placeName: string                // "5.В.01.056"
  zone: string                     // "Open space 29"
  blockCode: string                // "5.А.01" | "5.А.02" | "5.В.01" | "5.В.02"
  type: string                     // "Openspace" | "Coworking"
  category: string                 // "Основное"
  
  employeeName: string             // "ФИО сотрудника"
  tabNumber: string                // Табельный номер
  department: string               // "Название подразделения Блок-1"
  team?: string                    // "Команда. Описание"
  position?: string                // "Наименование шт.должности"
  
  status: "occupied" | "reserved" | "free"
  occupiedSince?: Date
  coworkingType?: "Coworking-1" | "Coworking-2" | ...
  
  createdAt: Date
  updatedAt: Date
}

interface ImportLog {
  _id: ObjectId
  importedAt: Date
  totalRows: number
  successfulRows: number
  errors: string[]
  fileName: string
}
```

---

## API Specification

### Search Endpoint
```
GET /api/search?type=name&q=Иванов
GET /api/search?type=place&q=5.В.01.056

Response:
{
  "success": true,
  "count": 3,
  "results": [
    {
      "id": "...",
      "placeNumber": "5.В.01.056",
      "placeName": "5.В.01.056",
      "zone": "Open space 29",
      "blockCode": "5.В.01",
      "type": "Openspace",
      "employeeName": "Иванов Иван Иванович",
      "department": "Департамент ИТ блока 'Сеть продаж'",
      "team": "SberGeo",
      "position": "Ведущий инженер по разработке"
    }
  ]
}
```

### Workplaces Endpoint (Table View)
```
GET /api/workplaces?view=table

Response:
{
  "success": true,
  "blocks": [
    {
      "blockCode": "5.А.01",
      "total": 65,
      "occupied": 60,
      "places": [
        {
          "id": "...",
          "placeNumber": "5.А.01.100",
          "employeeName": "Петров Петр Петрович",
          "department": "...",
          "team": "..."
        }
      ]
    }
  ]
}
```

### Coworkings Endpoint
```
GET /api/coworkings

Response:
{
  "success": true,
  "total": 90,
  "totalOccupied": 37,
  "coworkings": [
    {
      "id": "cw-1",
      "name": "Coworking-1",
      "total": 53,
      "occupied": 37,
      "places": [...]
    }
  ]
}
```

### Admin Upload Endpoint
```
POST /api/admin/upload
Content-Type: multipart/form-data

Body: {file: <xlsx-file>}

Response:
{
  "success": true,
  "message": "Загружено 260 мест из 262 строк",
  "importLog": {
    "importedAt": "2026-01-13T12:00:00Z",
    "successfulRows": 260,
    "totalRows": 262,
    "errors": [
      "Строка 150: отсутствует ФИО сотрудника",
      "Строка 200: некорректный номер места"
    ]
  }
}
```

---

## Risks & Mitigations

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|-----------|
| XLS имеет другую структуру (колонки в другом порядке) | High | High | Использовать названия колонок для маппинга, не индексы. Добавить валидацию на наличие обязательных колонок. |
| Облачная БД медленная на мобильной сети | Medium | Medium | Реализовать агрессивное кеширование на фронте. Использовать Firebase для оптимизированного мобильного доступа. |
| Много одновременных пользователей замораживают UI | Medium | Low | Использовать React.memo и useMemo для оптимизации. Ленивая загрузка компонентов. |
| Администратор случайно загрузит неправильный файл | Medium | High | Добавить подтверждение перед заменой данных. Сохранять backup последних загруженных данных. |
| Сотрудник введет неправильное имя при входе | Low | Low | Если имя не совпадает ни с одним в БД — просто разрешить вход с любым именем (для анонимного поиска). |

---

## Future Considerations

### Post-MVP Features
- Бронирование рабочих мест на определенное время
- История изменений (кто где был раньше)
- QR-коды на физических местах
- Push-уведомления о свободных местах
- Экспорт результатов поиска (PDF)
- Интеграция с календарем офиса
- Аналитика (графики занятости по времени, тепловая карта)
- Интеграция с корпоративной LDAP/AD для авторизации

### Scaling
- Если будет > 1000 мест: добавить индексирование поиска в MongoDB
- Если много параллельных загрузок XLS: добавить очередь задач (Bull, RabbitMQ)
- Если нужна синхронизация в реальном времени: добавить WebSockets (Socket.io)

---

## Appendix

### Key Dependencies

**Frontend:**
- react 19
- react-router-dom 7
- tailwindcss
- shadcn/ui
- zustand (state management)
- axios или fetch-api
- xlsx (парсинг XLS на клиенте)

**Backend:**
- express 4
- mongodb (или firebase-admin)
- xlsx
- joi
- cors
- dotenv

### File Structure for XLS Parsing

**Ожидаемые колонки из листа "Подробно":**
- Номер помещения (плэйс-номер)
- Наименование РМ
- Наименование зоны
- Тип РМ. Описание
- Категория РМ. Описание
- ФИО сотрудника
- Статус занятости РМ. Описание
- Название подразделения Блок-1
- Команда. Описание
- Наименование шт.должности
- Табельный номер

### Repository Structure
- GitHub: `github.com/techpark/workspace-finder`
- Branches: `main` (production), `develop` (staging), `feature/*` (features)
- CI/CD: GitHub Actions для автоматического теста и деплоя

---

**Document Version:** 1.0  
**Last Updated:** 2026-01-13  
**Author:** AI Assistant  
**Status:** Ready for Development
